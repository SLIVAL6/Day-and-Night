<html>

<head>
  <title>Computer Graphics Assessment 4</title>
</head>

<style>
  body {
    margin: 0;
  }

  canvas {
    width: 100%;
    height: 100%;
  }
</style>

<body>
  <link rel = "shortcut icon" href = "#">

  <style>
    body {
      font-family: Monospace;
      background-color: #000;
      color: #fff;
      margin: 0px;
      overflow: hidden;
    }

    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: left;
    }
  </style>

  <div id = "info">
    <p>
      Computer Graphics - Assessment 4<br>
      Perry<br>
    </p>
  </div>

  <script type = "importmap">
			{
				"imports": {
					"three": "./build/three.module.js"
				}
			}
	</script>

  <script type = "module">

    import * as THREE from 'three';
    import { OrbitControls } from './build/OrbitControls.js';
    import { OBJLoader } from './build/loaders/OBJLoader.js';
    import { MTLLoader } from './build/loaders/MTLLoader.js';

    // Create scene
    var scene = new THREE.Scene();
    var ratio = window.innerWidth / window.innerHeight;

    // Camera setup
    var camera = new THREE.PerspectiveCamera(45, ratio, 0.1, 1000);
    camera.position.set(0, 0, 15);
    camera.lookAt(0, 0, 1);

    // Lighting setup
    var cameralight = new THREE.PointLight( new THREE.Color(1,1,1), 1 );
 	  camera.add( cameralight );
 	  scene.add(camera);

    // Renderer setup
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Frame information
    var FrameMatrix = [];
    var subFrames = 10;
    var currFrame = 0;

    //Controls setup
    var controls = new OrbitControls(camera, renderer.domElement);

    // Loading models
    var mtlload=new MTLLoader();
    mtlload.setPath( 'models/' )
    mtlload.load( 'Street_Lamp_1.mtl', function ( materials ) 
    {
      materials.preload();
      var objload=new OBJLoader();
      objload.setMaterials( materials )
      objload.setPath( 'models/' )
      objload.load( 'Street_Lamp_1.obj', function ( object ) 
      {
        var box3 = new THREE.Box3();
        box3.setFromObject (object);
        var CenterBB= new THREE.Vector3();
        var SizeBB = new THREE.Vector3();
        box3.getCenter(CenterBB);
        box3.getSize(SizeBB);
        for ( var i = 0, l = object.children.length; i < l; i ++ ) 
        {
          object.children[i].material.color= new THREE.Color(1,1,1);
        }
        
        var sca = new THREE.Matrix4();
        var tra = new THREE.Matrix4();
        var combined = new THREE.Matrix4();

        sca.makeScale(20/SizeBB.length(),20/SizeBB.length(),20/SizeBB.length());
        tra.makeTranslation (-CenterBB.x,-CenterBB.y,-CenterBB.z);
        combined.multiply(sca);
        combined.multiply(tra);

            object.applyMatrix4(combined);
        scene.add( object );

        });
      } );

    // Clears the scene when parameters are updated
    function ClearScene() {
      for (let i = scene.children.length - 1; i >= 0; i--) {
        if (scene.children[i].type == "Mesh") {
          scene.remove(scene.children[i]);
        }
      }
    }

    
    // Creates Scene
    function CreateScene() {
    }

    CreateScene();

    
    // Final update loop
    var MyUpdateLoop = function () {
      renderer.render(scene, camera);
      controls.update();

      requestAnimationFrame(MyUpdateLoop);
    };

    requestAnimationFrame(MyUpdateLoop);

    function handleKeyDown(event) {
    }

  window.addEventListener('keydown', handleKeyDown, false);

    // Called when the window is resized
    var MyResize = function () {
      var width = window.innerWidth;
      var height = window.innerHeight;
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.render(scene, camera);
    };

    // Link the resize of the window to the camera update
    window.addEventListener('resize', MyResize);

    //MESH LOADING
    //var loader = new OBJLoader();
    //var mesh = null;
    /*loader.load('street_light02.obj', function ( geometry )
    {
          var material = new THREE.MeshPhongMaterial();
          material.color= new THREE.Color(0.8,1,1);
          material.wireframe=false;
          material.shininess=100;
          //geometry.computeVertexNormals();
          mesh = new THREE.Mesh( geometry, material );

          scene.add( mesh );
        } );*/
    

        
  </script>
</body>

</html>