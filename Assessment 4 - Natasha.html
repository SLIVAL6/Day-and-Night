<html>

<head>
  <title>Computer Graphics Assessment 4</title>
</head>

<style>
  body {
    margin: 0;
  }

  canvas {
    width: 100%;
    height: 100%;
  }
</style>

<body>
  <link rel = "shortcut icon" href = "#">

  <style>
    body {
      font-family: Monospace;
      background-color: #000;
      color: #fff;
      margin: 0px;
      overflow: hidden;
    }

    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: left;
    }
  </style>

  <div id = "info">
    <p>
      Computer Graphics - Assessment 4<br>
      Natasha<br>
    </p>
  </div>

  <script type = "importmap">
			{
				"imports": {
					"three": "./build/three.module.js"
				}
			}
	</script>

  <script type = "module">

    import * as THREE from 'three';
    import { OrbitControls } from './build/OrbitControls.js';
    import { Perlin } from './build/perlin.js';

    // Create scene
    var scene = new THREE.Scene();
    var ratio = window.innerWidth / window.innerHeight;

    // Camera setup
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
    var cameraTarget = {x:0, y:0, z:0};
    camera.position.y = 70;
    camera.position.z = 1000;
    //camera.rotation.y = Math.PI / 2999;

    // Renderer setup
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Clears the scene when parameters are updated
    function ClearScene() {
      for (let i = scene.children.length - 1; i >= 0; i--) {
        if (scene.children[i].type == "Mesh") {
          scene.remove(scene.children[i]);
        }
      }
    }

    // Frame information
    var FrameMatrix = [];
    var subFrames = 10;
    var currFrame = 0;

    //plane
    var planeGeometry = new THREE.PlaneGeometry(5000, 5000, 256, 256);
    //planeGeometry.rotateX(Math.PI / 2);
    var planeMaterial = new THREE.MeshBasicMaterial();
    planeMaterial.wireframe = true;
    var terrain = new THREE.Mesh(planeGeometry,planeMaterial);
    scene.add(terrain);

    var perlin = new Perlin();
    var peak = 60;
    var smoothing = 1000;
    var max = 0;
    var vertices = terrain.geometry.attributes.position.array;
    for (var i = 0; i <= vertices.length; i += 3) {
        vertices[i+2] = peak * perlin.noise(
            vertices[i]/smoothing, 
            vertices[i+1]/smoothing
        );
        if (vertices[i+2] > max){
              max = vertices[i+2];}
    }

    /*
    var perlin2 = new Perlin();
    var peak2 = 10;
    var smoothing2 = 0;
    //second one
    for (var i = 0; i <= vertices.length; i += 3) {
        vertices[i+2] += peak2 * perlin2.noise(
            vertices[i]/smoothing2, 
            vertices[i+1]/smoothing2,
        );
        if (vertices[i+2] > max){
              max = vertices[i+2];}
    }*/



    terrain.geometry.attributes.position.needsUpdate = true;
    terrain.geometry.computeVertexNormals();
    terrain.geometry.rotateX(Math.PI/2);

    var cubeGeo = new THREE.BoxGeometry(10,10);
    var cubeMat = new THREE.MeshBasicMaterial();
    var cube = new THREE.Mesh(cubeGeo, cubeMat);
    cube.position.y = max;
    console.log(max);
    //scene.add(cube);

    // Creates Scene
    function CreateScene() {
      //refreshVertices();
    }

    CreateScene();

    var controls = new OrbitControls(camera, renderer.domElement);

    // Final update loop
    var MyUpdateLoop = function () {
      renderer.render(scene, camera);
      controls.update();

      requestAnimationFrame(MyUpdateLoop);
    };

    requestAnimationFrame(MyUpdateLoop);

    function handleKeyDown(event) {
    }

  window.addEventListener('keydown', handleKeyDown, false);

    // Called when the window is resized
    var MyResize = function () {
      var width = window.innerWidth;
      var height = window.innerHeight;
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.render(scene, camera);
    };

    // Link the resize of the window to the camera update
    window.addEventListener('resize', MyResize);
  </script>
</body>

</html>